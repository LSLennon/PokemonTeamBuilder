@inject PokedexServices PokeService
@inject NavigationManager NavigationManager

@page "/{OnePokemon}"

@if (IsLoaded)
{
    <MudPaper Class="p-4">
        <MudGrid>
            <MudItem xs="12" sm="6" md="4" lg="4">
                <MudCard>
                    <MudImage Src="@pokemon.Image"
                              Alt="@pokemon.PokemonName"
                              Fluid="true"
                              Class="pokemon-image" />
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6" md="4" lg="4">
                <MudCard Class="scaling">
                    <MudCardContent>
                        <!-- Row 1-->
                        <MudGrid Class="mb-4">
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.body2">Dex No: @pokemon.PokemonId</MudText>
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">@pokemon.PokemonName.CapitalizeName()</MudText>
                            </MudItem>
                        </MudGrid>
                        <MudGrid Class="mb-4">
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.body2">Height: @pokemon.Height</MudText>
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.body2">Weight: @pokemon.Weight</MudText>
                            </MudItem>
                        </MudGrid>
                        <MudGrid Justify="Justify.Center" AlignItems="AlignItems.Center" Style="width: 100%;" Class="mb-4">
                            @foreach (var type in pokemon.PokemonTypes)
                            {
                                <MudItem>
                                    <TypeDisplay Text="@type.PokeType.PokeTypeName" />
                                </MudItem>
                            }
                        </MudGrid>
                        <MudGrid Justify="Justify.Center" AlignItems="AlignItems.Center" Style="width: 100%;" Class="mb-4">
                            @foreach (var ability in pokemon.Abilities)
                            {
                                <MudItem>
                                    <MudTooltip Text="@ability.PokeAbility.AbilityDescription">
                                        <MudButton Variant="Variant.Filled" Size="Size.Small" Class="ability">
                                            @ability.PokeAbility.AbilityName
                                        </MudButton>
                                    </MudTooltip>
                                </MudItem>
                            }
                        </MudGrid>
                        <MudGrid Class="mb-4">
                            <MudItem xs="12" sm="12" md="12" lg="12">
                                <MudText Typo="Typo.body2">Pokedex: @pokemon.PokedexEntry</MudText>
                            </MudItem>
                        </MudGrid>
                        <MudGrid Class="mb-4">
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">x4 Weakness</MudText>
                                @if (typeChart.X4Weakness.Any())
                                {
                                    @foreach (var dmg in typeChart.X4Weakness)
                                    {
                                        <TypeDisplay Text="@dmg" />
                                    }
                                }
                                else
                                {
                                    <MudText Typo="Typo.body2">None</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">x2 Weakness</MudText>
                                @if (typeChart.x2Weakness.Any())
                                {
                                    @foreach (var dmg in typeChart.x2Weakness)
                                    {
                                        <TypeDisplay Text="@dmg" />
                                    }
                                }
                                else
                                {
                                    <MudText Typo="Typo.body2">None</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">No Damage</MudText>
                                @if (typeChart.NoDamage.Any())
                                {
                                    @foreach (var dmg in typeChart.NoDamage)
                                    {
                                        <TypeDisplay Text="@dmg" />
                                    }
                                }
                                else
                                {
                                    <MudText Typo="Typo.body2">None</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">2x Resistance</MudText>
                                @if (typeChart.X2Resist.Any())
                                {
                                    @foreach (var dmg in typeChart.X2Resist)
                                    {
                                        <TypeDisplay Text="@dmg" />
                                    }
                                }
                                else
                                {
                                    <MudText Typo="Typo.body2">None</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="6" md="6" lg="6">
                                <MudText Typo="Typo.h6">4x Resistance</MudText>
                                @if (typeChart.X4Resist.Any())
                                {
                                    @foreach (var dmg in typeChart.X4Resist)
                                    {
                                        <TypeDisplay Text="@dmg" />
                                    }
                                }
                                else
                                {
                                    <MudText Typo="Typo.body2">None</MudText>
                                }
                            </MudItem>
                        </MudGrid>


                    </MudCardContent>
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6" md="4" lg="4">
                <MudCard>
                    <MudCardContent>
                        <MudChart ChartType="ChartType.StackedBar" ChartSeries="@Series" @bind-SelectedIndex="Index" XAxisLabels="@XAxisLabels" Width="100%" Height="350px"></MudChart>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="12" md="12" lg="12">
                <MudCard>
                    <MudCardContent>
                        <MoveTable MoveList="LevelUpMoves" TableType="LevelUp" />
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="12" md="12" lg="12">
                <MudCard>
                    <MudCardContent>
                        <MoveTable MoveList="MachineMoves" TableType="Machine"/>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="12" md="12" lg="12">
                <MudCard>
                    <MudCardContent>
                        <MoveTable MoveList="EggMoves" TableType="Egg" />
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>
    </MudPaper>
}

@code {
    [Parameter]
    public string OnePokemon { get; set; } = "zubat";

    Pokemon pokemon = new Pokemon();
    TypeChart typeChart = new TypeChart();
    List<MPokemonToMoves> LevelUpMoves = new List<MPokemonToMoves>();
    List<MPokemonToMoves> MachineMoves = new List<MPokemonToMoves>();
    List<MPokemonToMoves> EggMoves = new List<MPokemonToMoves>();

    public bool IsLoaded = false;

    public int imageIndex = 0;

    private int Index = -1;

    public List<ChartSeries> Series = new List<ChartSeries>();

    public string[] XAxisLabels = { "HP", "Atk", "Def", "SpAtk", "SpDef", "Spe" };

    protected override async Task OnInitializedAsync()
    {
        pokemon = await PokeService.GetPokemonByName(OnePokemon);

        if (pokemon != null)
        {
            typeChart = await PokeService.GetTypeInfo(pokemon.PokemonTypes.ToList());
            ChartSeries series = new ChartSeries
                {
                    Name = "Base Stats",
                    Data = new double[]
                        {
                        pokemon.BaseStats.HP,
                        pokemon.BaseStats.Attack,
                        pokemon.BaseStats.Defence,
                        pokemon.BaseStats.SpAttack,
                        pokemon.BaseStats.SpDefence,
                        pokemon.BaseStats.Speed
                        }
                };
            Series.Add(series);
            LevelUpMoves = pokemon.Moves.Where(p => p.PokeMethod.Name == "level-up").ToList();
            MachineMoves = pokemon.Moves.Where(p => p.PokeMethod.Name == "machine").ToList();
            EggMoves = pokemon.Moves.Where(p => p.PokeMethod.Name == "egg").ToList();
            IsLoaded = true;
            StateHasChanged();
        }
    }
}
